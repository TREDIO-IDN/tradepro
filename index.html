<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TREDIO Preview (clean M/N/K)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{ --bg:#0b0b0c; --panel:#111217; --muted:#9aa0a6; --accent:#f1c40f; }
  html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:Inter,Arial}
  .app{ max-width:980px;margin:12px auto;padding:12px; display:grid;grid-template-columns:1fr 360px;gap:12px; }
  @media (max-width:900px){ .app{ grid-template-columns:1fr; padding:8px } }
  .panel{ background:linear-gradient(180deg,#070708 0%, var(--panel) 100%); border-radius:12px;padding:12px;box-shadow:0 6px 20px rgba(0,0,0,0.6); position:relative; }
  .saldo { font-weight:700;color:#fff }
  .chart-wrap{ position:relative; background:#000;border-radius:10px;padding:8px; }
  canvas{ width:100% !important; height:360px !important; display:block; border-radius:8px; }
  .side{ display:flex;flex-direction:column;gap:12px; }
  .card{ background:#0f1113;padding:12px;border-radius:10px; }
  .small-muted{ color:#9aa0a6; font-size:13px }

  /* STATUS M/N/K KECIL BEBAS WARNA */
  #statusBox{
    margin-top:8px;
    text-align:center;
    font-size:16px;
    font-weight:700;
    padding:6px 0;
  }
  .result-win, .result-lose { color:inherit !important; }

  /* Tombol M N K */
  .mnk-row{
    display:flex;
    justify-content:center;
    gap:10px;
    margin-top:8px;
  }
  .mnk-btn{
    background:none;
    border:1px solid #444;
    color:#fff;
    font-size:16px;
    padding:6px 14px;
    border-radius:8px;
    cursor:pointer;
  }
  .mnk-btn:active{ background:#333 }

</style>
</head>
<body>

<div class="app" id="mainApp">
  <div class="panel">
    <div class="header">
      <div>
        <div style="font-size:14px;color:#ddd">Harga Batubara Premium</div>
      </div>
      <div style="text-align:right">
        <div class="small-muted">Saldo Real:</div>
        <div class="saldo" id="saldoText">Rp 140.000.000</div>
      </div>
    </div>

    <div class="chart-wrap"><canvas id="chartCanvas"></canvas></div>

    <div style="display:flex;justify-content:space-between;margin-top:10px;">
      <div class="small-muted">Open: <span id="txtOpen">-</span></div>
      <div class="small-muted">Now: <span id="txtNow">-</span></div>
      <div class="small-muted">Sisa: <span id="txtCountdown">-</span></div>
    </div>
  </div>

  <div class="side">
    <div class="card">
      <div>Pilih Nominal</div>
      <input id="manualAmount" type="number" placeholder="Nominal" style="width:100%;margin-top:6px;padding:8px;border-radius:8px;border:1px solid #222;background:#0b0b0b;color:white" />

      <button id="btnUp" style="margin-top:10px;width:100%;padding:10px;border-radius:8px;border:none;background:#1d1;cursor:pointer">NAIK</button>
      <button id="btnDown" style="margin-top:6px;width:100%;padding:10px;border-radius:8px;border:none;background:#d11;cursor:pointer">TURUN</button>

      <!-- STATUS -->
      <div id="statusBox">N</div>

      <!-- TOMBOL M N K -->
      <div class="mnk-row">
        <button class="mnk-btn" id="btnM">m</button>
        <button class="mnk-btn" id="btnN">n</button>
        <button class="mnk-btn" id="btnK">k</button>
      </div>

    </div>
  </div>
</div>

<script>
const saldoText=document.getElementById('saldoText');
const txtNow=document.getElementById('txtNow');
const txtOpen=document.getElementById('txtOpen');
const txtCountdown=document.getElementById('txtCountdown');
const statusBox=document.getElementById('statusBox');
const btnUp=document.getElementById('btnUp');
const btnDown=document.getElementById('btnDown');
const manualAmount=document.getElementById('manualAmount');

let saldo=140000000;
function formatIDR(v){return 'Rp '+Number(v).toLocaleString('id-ID');}
saldoText.textContent=formatIDR(saldo);

const ctx=document.getElementById('chartCanvas').getContext('2d');
const chart=new Chart(ctx,{type:'line',data:{labels:[],datasets:[{data:[],borderColor:'#fff',tension:0.2,pointRadius:0}]},options:{animation:false,responsive:true,maintainAspectRatio:false,scales:{x:{display:false},y:{ticks:{color:'#aaa'},grid:{color:'#222'}}}}});

// harga dummy
function harga(){ return 75 + (Math.random()-0.5)*0.02; }
setInterval(()=>{
  const h=harga();
  txtNow.textContent=h.toFixed(3);
  chart.data.labels.push('');
  chart.data.datasets[0].data.push(h);
  if(chart.data.labels.length>100){chart.data.labels.shift();chart.data.datasets[0].data.shift();}
  chart.update('none');
},1000);

let trading=false, openPrice=null, timer=null, cd=0;

function startTrade(dir){
  if(trading) return;
  const amt=Number(manualAmount.value||0);
  if(amt<=0) return alert('Nominal belum diisi');
  if(amt>saldo) return alert('Saldo tidak cukup');

  trading=true;
  openPrice=chart.data.datasets[0].data.slice(-1)[0];
  txtOpen.textContent=openPrice.toFixed(3);
  cd=10; // contoh durasi 10 detik
  txtCountdown.textContent=cd;
  statusBox.textContent='n';

  timer=setInterval(()=>{
    cd--; txtCountdown.textContent=cd;
    if(cd<=0){ finish(dir,amt); }
  },1000);
}

function finish(dir,amt){
  clearInterval(timer);
  const close=chart.data.datasets[0].data.slice(-1)[0];
  let win=false;
  if(dir==='naik') win = close>openPrice;
  else win = close<openPrice;

  if(win){ saldo+=amt; statusBox.textContent='m'; }
  else { saldo-=amt; statusBox.textContent='k'; }

  saldoText.textContent=formatIDR(saldo);
  trading=false;
}

btnUp.onclick=()=>startTrade('naik');
btnDown.onclick=()=>startTrade('turun');

document.getElementById('btnM').onclick=()=>statusBox.textContent='m';
document.getElementById('btnN').onclick=()=>statusBox.textContent='n';
document.getElementById('btnK').onclick=()=>statusBox.textContent='k';
</script>

</body>
</html>
